> websocket是前后端交互的长连接，前后端也都**可能因为一些情况导致连接失效并且相互之间没有反馈提醒**。因此**为了保证连接的可持续性和稳定性**，websocket心跳重连就应运而生

> 后端websocket服务也可能出现异常，造成连接断开，这时前端也并没有收到断开通知，因此需要前端定时发送心跳消息**ping**，后端收到**ping**类型的消息，立马返回**pong**消息，告知前端连接正常。如果一定时间没收到**pong**消息，就说明连接不正常，前端便会执行重连

#### 心跳机制

> 心跳机制是每隔一段时间会向服务器发送一个数据包，告诉服务器自己还活着，同时客户端会确认服务器端是否还活着，如果还活着的话，就会回传一个数据包给客户端来确定服务器端也还活着，否则的话，有可能是网络断开连接了，需要重连

![image-20220418230506366](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220418230506366.png)

> 心跳分为客户端心跳和服务端心跳

> 客户端心跳
>
> - 网页关闭会主动触发服务端事件onclose
> - 手动断网会触发客户端onerror,再次打开网络时不会触发客户端onclose,onerror事件.(需要监听网络情况，有网时重连)
> - 用开发者工具断网时，长时间会触发客户端onclose,onerror事件，再次打开网络时也会触发客户端onclose,onerror事件
> - 电梯中断网会一直触发客户端onerror事件~~~~

